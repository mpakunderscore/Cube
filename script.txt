if (gpio) {

1 5 true Магнитный замок вход
2 6 true Общее освещение
3 13 true УФ-лампа
4 19 true Замок арфа
5 26 true Замок люк на крыше
6 12 true Замок кодовый сейф
7 16 true Замок паззл
8 20 true Замок звезды
9 4 false Сигнал от арфы
10 17 false Сигнал от “стучалки”
11 27 false Сигнал от кодового замка
12 22 false Сигнал от паззла
13 23 false Сигнал от паззла 2
14 24 false Сигнал от звезд
15 25 false Сигнал от подиума с медальонами
16 18 false Сигнал от “стража”
17 21 true Глаза “стража”

}


При нажатии кнопки “старт” запускается квест. Устанавливается положение ON на исполнителях 1,2,4,5,6,7,8, OFF на 3 и 17. 

if (start) {
    1 = true
    2 = true
    4 = true
    5 = true
    6 = true
    7 = true
    8 = true

    3 = false
    17 = false
}

Проверяется, что на сенсорах 9-16 стоит значение OFF. Если какой-то из них находится в значении ON выходит табличка: “Игра не собрана. Запустить квест?” и ответ да/нет.
Запускается саундтрек (на джек идёт)

if (проверяем сенсоры) {

    если есть сигнал - спросить про запуск

    не слушаем сенсоры
    13 = null
    16 = null

    sound(0)
}

Далее сценарий действий следующий: система опрашивает сенсоры и выполняет действия в зависимости от изменений их значения.

Следующие задачи выполняются параллельно:

При срабатывании сенсора 9 устанавливаем 4 в значение OFF
При срабатывании сенсора 10 устанавливаем 5 в значение OFF
При срабатывании сенсора 11 устанавливаем 6 в значение OFF
При срабатывании сенсора 14 устанавливаем 8 в значение OFF

if (9) {
    4 = false
}

if (10) {
    5 = false
}

if (11) {
    6 = false
}

if (14) {
    8 = false
}

Еще одна задача выполняется параллельно этим, но её шаги должны быть последовательны:
При срабатывании сенсора 12 устанавливаем 17 в значение ON и начинаем слушать сенсоры 16 и 13. На сенсор 16 реагируем многоразово, при его срабатывании ставим 2 в OFF и 3 в ON, при его деактивации - ставим 2 в ON и 3 в OFF. При срабатывании сенсора 13 ставим 7 в OFF, 3 в OFF, 2 в ON, 17 в OFF, перестаем слушать сенсор 16.

if (12) {
    17 = true

    теперь слушаем эти сенсоры
    16 = false
    13 = false
}

if (16) {
    2 = false
    3 = true
}

if (!16) {
    2 = true
    3 = false
}

if (13)  {
    7 = false
    3 = false
    2 = true
    17 = false

    TODO это сенсор, и его неперь не слушаем
    16 = null
}

Когда все вышеперечисленные задачи выполнены, начинаем слушать сенсор 15, при его срабатывании меняем проигрываемый трек, ставим 2 в OFF, через 10 секунд ставим 1 в OFF.

if (?) {
    15 = false
}

if (15) {
    меняем проигрываемый трек
    sound(1)
    2 = false
    wait(10)
    1 = false
}

Если время игры заканчивается раньше, чем игроки прошли - тоже меняем проигрываемый трек на другой, ставим 2 в OFF, через 10 секунд ставим 1 в OFF.

if (end) {
    меняем проигрываемый трек на другой
    sound(2)
    2 = false
    wait(10)
    1 = false
}